<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tech CV - AI Career Center</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- TensorFlow.js for AI/ML -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.15.0/dist/tf.min.js"></script>
    
    <!-- Face-api.js for face detection and facial expression analysis -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    
    <!-- MediaPipe Face Mesh for detailed facial landmark detection -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh@0.4.1633559619/face_mesh.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.js"></script>
    
    <!-- MediaPipe Pose Detection for body posture analysis -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5.1675469404/pose.js"></script>
    
    <!-- OpenCV.js for advanced image processing -->
    <script async src="https://docs.opencv.org/4.8.0/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
    
    <!-- Tesseract.js for OCR (Optical Character Recognition) -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    
    <!-- PDF.js for PDF text extraction -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>
    
    <!-- Fabric.js for canvas manipulation -->
    <script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
    
    <!-- Jimp for client-side image processing -->
    <script src="https://cdn.jsdelivr.net/npm/jimp@0.22.10/browser/lib/jimp.min.js"></script>
    
    <!-- Additional image processing libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sharp@0.32.6/dist/sharp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas@2.11.2/build/Release/canvas.node"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .back-btn {
            position: fixed;
            top: 1rem;
            left: 1rem;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: #667eea;
            text-decoration: none;
            backdrop-filter: blur(10px);
            z-index: 1000;
            font-size: 0.9rem;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 1.5rem;
            color: white;
            padding: 1rem 0;
        }

        .header h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }        .mode-selector {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .mode-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            min-width: 150px;
            justify-content: center;
        }

        .mode-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #667eea;
            border-color: rgba(255, 255, 255, 0.9);
        }

        .content-area {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            min-height: 500px;
        }

        .mode-content {
            display: none;
        }

        .mode-content.active {
            display: block;
        }        /* CV Analysis Styles */
        .cv-analysis-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            height: 60vh;
            min-height: 500px;
        }

        .upload-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 2px dashed #e2e8f0;
            border-radius: 16px;
            padding: 1.5rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
        }

        .upload-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(102, 126, 234, 0.03), transparent);
            transition: transform 0.6s ease;
            transform: translateX(-100%);
        }

        .upload-section:hover::before {
            transform: translateX(100%);
        }

        .upload-section:hover {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.02) 0%, rgba(118, 75, 162, 0.02) 100%);
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.1);
        }

        .upload-section.has-file {
            border-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 150, 105, 0.05) 100%);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.15);
        }

        .upload-section.has-file::before {
            background: linear-gradient(45deg, transparent, rgba(16, 185, 129, 0.05), transparent);
        }        .upload-icon {
            font-size: 3.5rem;
            color: #667eea;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1;
        }

        .upload-section:hover .upload-icon {
            transform: scale(1.1);
            color: #5a67d8;
        }

        .upload-section.has-file .upload-icon {
            color: #10b981;
        }

        .upload-section h2 {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #1a202c;
            position: relative;
            z-index: 1;
        }

        .upload-section p {
            font-size: 0.95rem;
            color: #4a5568;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .file-format-info {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(102, 126, 234, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #667eea;
            font-weight: 500;
            margin-top: 1rem;
        }        .cv-results {
            display: none;
            flex-direction: column;
            gap: 1.5rem;
            height: 100%;
            animation: slideUp 0.6s ease;
            overflow-y: auto;
        }

        .cv-results.active {
            display: flex;
        }

        .score-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem 1rem;
            border-radius: 16px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            flex-shrink: 0;
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: pulse 3s ease-in-out infinite;
        }        .score-number {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 0.3rem;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .score-label {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
            position: relative;
            z-index: 1;
        }

        .score-description {
            font-size: 0.85rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .score-gauge {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 1.5rem;
            margin-top: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .gauge-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .gauge-title {
            font-weight: 600;
            color: #2d3748;
            font-size: 1rem;
        }

        .gauge-score {
            font-weight: 700;
            color: #667eea;
            font-size: 1.1rem;
        }

        .gauge-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .gauge-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #667eea, #764ba2);
            border-radius: 4px;
            transition: width 1.5s ease;
            position: relative;
        }

        .gauge-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s ease-in-out infinite;
        }        .feedback-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            flex: 1;
            overflow-y: auto;
        }

        .feedback-tabs {
            display: flex;
            gap: 0.3rem;
            margin-bottom: 1.5rem;
            background: #f1f5f9;
            padding: 0.3rem;
            border-radius: 10px;
        }

        .feedback-tab {
            flex: 1;
            padding: 0.6rem 0.8rem;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.85rem;
            color: #64748b;
        }

        .feedback-tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
        }

        .feedback-content {
            display: none;
        }

        .feedback-content.active {
            display: block;
            animation: fadeInUp 0.4s ease;
        }

        .feedback-section {
            margin-bottom: 1.5rem;
        }

        .feedback-section h4 {
            color: #1a202c;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
        }

        .feedback-items {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }

        .feedback-item {
            background: #f8fafc;
            padding: 0.8rem 1rem;
            border-radius: 10px;
            border-left: 3px solid #e2e8f0;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .feedback-item.strength {
            border-left-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }

        .feedback-item.weakness {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .feedback-item.recommendation {
            border-left-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .feedback-item:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }        /* Interview Mode Styles */
        .interview-setup {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .cv-upload {
            background: #f8fafc;
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cv-upload:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .cv-upload.has-file {
            border-color: #48bb78;
            background: rgba(72, 187, 120, 0.1);
        }

        .interview-config {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .config-group {
            margin-bottom: 1.2rem;
        }

        .config-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: #2d3748;
            font-size: 0.9rem;
        }

        .config-group select,
        .config-group input {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .interview-chat {
            display: none;
            height: 600px;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            background: white;
        }

        .interview-chat.active {
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .interview-controls {
            background: #f8fafc;
            padding: 0.8rem 1rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .interview-status {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #48bb78;
            animation: pulse 2s infinite;
        }

        .interview-actions {
            display: flex;
            gap: 0.5rem;
        }

        .control-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .control-btn.stop {
            background: #fed7d7;
            color: #c53030;
        }

        .control-btn.stop:hover {
            background: #feb2b2;
        }

        .control-btn.camera {
            background: #bee3f8;
            color: #2b6cb0;
        }

        .control-btn.camera:hover {
            background: #90cdf4;
        }

        .control-btn.camera.active {
            background: #48bb78;
            color: white;
        }

        .interview-main {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .camera-panel {
            width: 300px;
            background: #f8fafc;
            border-left: 1px solid #e2e8f0;
            padding: 1rem;
            display: none;
        }

        .camera-panel.active {
            display: block;
        }

        .video-feed {
            position: relative;
            width: 100%;
            height: 200px;
            background: #1a202c;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e2e8f0;
            margin-bottom: 1rem;
        }

        #candidateVideo {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .camera-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            text-align: center;
            pointer-events: none;
        }

        .behavior-analysis {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid #e2e8f0;
        }

        .behavior-score {
            text-align: center;
            margin-bottom: 1rem;
        }

        .behavior-score-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
        }

        .behavior-indicators {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .behavior-indicator {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
        }

        .indicator-name {
            color: #4a5568;
        }

        .indicator-status {
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .indicator-status.good {
            background: rgba(72, 187, 120, 0.1);
            color: #48bb78;
        }

        .indicator-status.average {
            background: rgba(237, 137, 54, 0.1);
            color: #ed8936;
        }

        .indicator-status.poor {
            background: rgba(245, 101, 101, 0.1);
            color: #f56565;
        }

        /* CV Breakdown Styles */
        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.4rem 0;
            color: #4a5568;
        }

        .breakdown-item strong {
            color: #2d3748;
            font-weight: 600;
        }

        .score-breakdown {
            border: 1px solid #e2e8f0;
        }

        .interview-results {
            display: none;
            padding: 2rem;
            text-align: center;
            background: #f8fafc;
            border-radius: 15px;
            margin: 1rem;
        }

        .interview-results.active {
            display: block;
        }

        .results-header {
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 0.5rem;
        }

        .results-subtitle {
            color: #4a5568;
            font-size: 1rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .result-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .result-card h3 {
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .behavior-breakdown {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .behavior-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: #f8fafc;
            border-radius: 6px;
        }

        .behavior-name {
            font-size: 0.9rem;
            color: #4a5568;
        }

        .behavior-score-small {
            font-weight: 600;
            padding: 0.2rem 0.6rem;
            border-radius: 10px;
            font-size: 0.8rem;
        }

        .score-excellent {
            background: rgba(72, 187, 120, 0.1);
            color: #48bb78;
        }

        .score-good {
            background: rgba(66, 153, 225, 0.1);
            color: #4299e1;
        }

        .score-average {
            background: rgba(237, 137, 54, 0.1);
            color: #ed8936;
        }

        .score-poor {
            background: rgba(245, 101, 101, 0.1);
            color: #f56565;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: #f8fafc;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 12px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
        }

        .message.ai {
            background: white;
            border: 1px solid #e2e8f0;
            margin-right: auto;
        }

        .message.user {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            margin-left: auto;
        }

        .chat-input {
            display: flex;
            padding: 1rem;
            border-top: 1px solid #e2e8f0;
            background: white;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-right: 0.5rem;
        }

        .chat-input button {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }        /* Holland Test Styles */
        .holland-test {
            max-width: 700px;
            margin: 0 auto;
        }

        .test-progress {
            background: #e2e8f0;
            border-radius: 8px;
            height: 6px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .test-progress-bar {
            background: linear-gradient(135deg, #667eea, #764ba2);
            height: 100%;
            transition: width 0.3s ease;
            width: 0%;
        }

        .question-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .question-card.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .question-number {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
        }

        .question-text {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #2d3748;
        }

        .answer-options {
            display: grid;
            gap: 0.8rem;
        }

        .answer-option {
            padding: 0.8rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            font-size: 0.9rem;
        }

        .answer-option:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .answer-option.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .test-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }

        .nav-btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .nav-btn.primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .nav-btn.secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Results and Career Chat */
        .test-results {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .test-results.active {
            display: block;
        }

        .personality-type {
            font-size: 3rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .personality-description {
            font-size: 1.2rem;
            color: #4a5568;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .career-suggestions {
            background: #f8fafc;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
        }

        .career-chat {
            display: none;
            margin-top: 2rem;
        }

        .career-chat.active {
            display: block;
        }        .start-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            margin: 0 auto;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .loading {
            display: none;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            color: #667eea;
            font-weight: 600;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }

        .loading.show {
            display: flex;
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid #e2e8f0;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            .header {
                margin-bottom: 1rem;
                padding: 0.5rem 0;
            }

            .header h1 {
                font-size: 1.8rem;
                margin-bottom: 0.3rem;
            }

            .header p {
                font-size: 0.9rem;
            }

            .mode-selector {
                flex-direction: column;
                align-items: center;
                gap: 0.8rem;
                margin-bottom: 1.5rem;
            }

            .mode-btn {
                min-width: 200px;
                padding: 0.7rem 1rem;
                font-size: 0.85rem;
            }

            .content-area {
                padding: 1rem;
                min-height: 400px;
            }

            .interview-setup,
            .cv-analysis-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                height: auto;
            }

            .cv-analysis-container {
                min-height: 400px;
            }

            .upload-section,
            .cv-upload,
            .interview-config {
                padding: 1rem;
                margin-bottom: 1rem;
            }

            .upload-section h2 {
                font-size: 1.2rem;
            }

            .upload-section p {
                font-size: 0.85rem;
            }

            .upload-icon {
                font-size: 2.5rem;
                margin-bottom: 0.8rem;
            }

            .cv-results {
                margin-top: 1rem;
            }

            .feedback-section h4 {
                font-size: 0.95rem;
            }

            .feedback-item {
                padding: 0.7rem 0.8rem;
                font-size: 0.85rem;
            }

            .score-number {
                font-size: 2.2rem;
            }

            .score-card {
                padding: 1.2rem 0.8rem;
            }

            .holland-test {
                max-width: 100%;
            }

            .question-card {
                padding: 1.2rem;
            }

            .question-text {
                font-size: 1rem;
                margin-bottom: 1.2rem;
            }

            .answer-option {
                padding: 0.7rem;
                font-size: 0.85rem;
            }

            .nav-btn {
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
            }

            .start-btn {
                padding: 0.7rem 1.2rem;
                font-size: 0.9rem;
            }

            /* Mobile interview adjustments */
            .interview-chat {
                height: 500px;
            }

            .interview-controls {
                flex-direction: column;
                gap: 0.8rem;
                align-items: stretch;
            }

            .interview-status {
                justify-content: center;
            }

            .interview-actions {
                justify-content: center;
            }

            .control-btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }

            .interview-main {
                flex-direction: column;
            }

            /* Mobile breakdown adjustments */
            .breakdown-grid {
                grid-template-columns: 1fr !important;
                gap: 0.3rem !important;
            }

            .breakdown-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.3rem 0;
                border-bottom: 1px solid #e9ecef;
            }

            .breakdown-item:last-child {
                border-bottom: none;
            }

            .camera-panel {
                width: 100%;
                border-left: none;
                border-top: 1px solid #e2e8f0;
                padding: 0.8rem;
            }

            .video-feed {
                width: 200px;
                height: 150px;
                margin: 0 auto 1rem auto;
            }

            .behavior-analysis {
                padding: 0.8rem;
            }

            .behavior-score-number {
                font-size: 1.5rem;
            }

            .behavior-indicator {
                font-size: 0.8rem;
            }

            .results-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .result-card {
                padding: 1rem;
            }

            .back-btn {
                top: 0.5rem;
                left: 0.5rem;
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">
        <span class="material-symbols-outlined">arrow_back</span>
        Quay lại
    </a>

    <div class="container">
        <div class="header">
            <h1>🤖 AI Career Center</h1>
            <p>Trung tâm AI tích hợp: Phân tích CV, Phỏng vấn ảo và Tư vấn nghề nghiệp với công nghệ Gemini AI</p>
        </div>

        <div class="mode-selector">
            <button class="mode-btn active" data-mode="cv-analysis">
                <span class="material-symbols-outlined">assessment</span>
                Phân Tích CV
            </button>
            <button class="mode-btn" data-mode="interview">
                <span class="material-symbols-outlined">smart_toy</span>
                Phỏng Vấn Ảo
            </button>
            <button class="mode-btn" data-mode="holland">
                <span class="material-symbols-outlined">psychology_alt</span>
                Tư Vấn Nghề Nghiệp
            </button>
        </div>

        <div class="content-area">
            <!-- CV Analysis Mode -->
            <div class="mode-content active" id="cv-analysis-mode">
                <div class="cv-analysis-container">
                    <div class="upload-section" id="cv-upload-section">
                        <div class="upload-icon">
                            <span class="material-symbols-outlined">upload_file</span>
                        </div>
                        <h2>Phân Tích & Chấm Điểm CV</h2>
                        <p>Tải lên CV của bạn để nhận được đánh giá chi tiết từ AI</p>
                        <p style="margin-top: 0.5rem; color: #e53e3e; font-size: 0.9rem; font-weight: 600;">
                            ⚠️ Hiện tại chỉ hỗ trợ CV dạng hình ảnh: JPG, PNG (Tối đa 10MB)
                        </p>
                        
                        <!-- Công thức tính điểm CV -->
                        <div class="scoring-formula" style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 1rem; margin: 1rem 0; font-size: 0.85rem;">
                            <h4 style="margin: 0 0 0.5rem 0; color: #495057; font-size: 0.9rem;">
                                <span class="material-symbols-outlined" style="font-size: 1rem; vertical-align: middle; margin-right: 0.3rem;">calculate</span>
                                Công Thức Tính Điểm CV (100 điểm)
                            </h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; color: #6c757d;">
                                <div>• <strong>Trình bày & Định dạng:</strong> 20 điểm</div>
                                <div>• <strong>Thông tin cá nhân:</strong> 15 điểm</div>
                                <div>• <strong>Kinh nghiệm làm việc:</strong> 25 điểm</div>
                                <div>• <strong>Học vấn & Chứng chỉ:</strong> 20 điểm</div>
                                <div>• <strong>Kỹ năng chuyên môn:</strong> 15 điểm</div>
                                <div>• <strong>Tính phù hợp vị trí:</strong> 5 điểm</div>
                            </div>
                            <p style="margin: 0.5rem 0 0 0; font-style: italic; color: #6c757d; font-size: 0.8rem;">
                                * AI sẽ đánh giá từng tiêu chí và tổng hợp điểm số cuối cùng
                            </p>
                        </div>
                        <input type="file" id="cv-analysis-file" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;">
                        <div id="cv-file-info" style="display: none; margin-top: 1rem;">
                            <p id="cv-file-name" style="font-weight: 600; color: #48bb78;"></p>
                        </div>
                        <button class="start-btn" id="analyze-cv-btn" style="margin-top: 1.5rem; display: none;">
                            <span class="material-symbols-outlined">psychology</span>
                            Phân Tích CV
                        </button>
                    </div>

                    <div class="cv-results" id="cv-analysis-results">
                        <div class="score-card">
                            <div class="score-number" id="cv-score">--</div>
                            <p>Điểm CV</p>
                            <p style="font-size: 0.9rem; opacity: 0.8;">Trên thang điểm 100</p>
                            <div id="cv-rating" style="margin-top: 0.5rem; padding: 0.3rem 0.8rem; border-radius: 15px; font-size: 0.8rem; font-weight: 600; display: inline-block;"></div>
                        </div>
                        
                        <!-- Breakdown điểm số chi tiết -->
                        <div class="score-breakdown" id="cv-score-breakdown" style="background: #f8f9fa; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; display: none;">
                            <h4 style="margin: 0 0 0.8rem 0; color: #495057; font-size: 0.9rem;">
                                <span class="material-symbols-outlined" style="font-size: 1rem; vertical-align: middle; margin-right: 0.3rem;">analytics</span>
                                Chi Tiết Điểm Số
                            </h4>
                            <div class="breakdown-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.85rem;">
                                <div class="breakdown-item">
                                    <span>Trình bày & Định dạng:</span>
                                    <strong id="score-presentation">--/20</strong>
                                </div>
                                <div class="breakdown-item">
                                    <span>Thông tin cá nhân:</span>
                                    <strong id="score-personal">--/15</strong>
                                </div>
                                <div class="breakdown-item">
                                    <span>Kinh nghiệm làm việc:</span>
                                    <strong id="score-experience">--/25</strong>
                                </div>
                                <div class="breakdown-item">
                                    <span>Học vấn & Chứng chỉ:</span>
                                    <strong id="score-education">--/20</strong>
                                </div>
                                <div class="breakdown-item">
                                    <span>Kỹ năng chuyên môn:</span>
                                    <strong id="score-skills">--/15</strong>
                                </div>
                                <div class="breakdown-item">
                                    <span>Tính phù hợp vị trí:</span>
                                    <strong id="score-relevance">--/5</strong>
                                </div>
                            </div>
                        </div>
                        
                        <div class="feedback-card">
                            <div class="feedback-section">
                                <h4>
                                    <span class="material-symbols-outlined" style="color: #48bb78;">check_circle</span>
                                    Điểm Mạnh
                                </h4>
                                <div id="cv-strengths"></div>
                            </div>
                            <div class="feedback-section">
                                <h4>
                                    <span class="material-symbols-outlined" style="color: #f56565;">error</span>
                                    Cần Cải Thiện
                                </h4>
                                <div id="cv-weaknesses"></div>
                            </div>
                            <div class="feedback-section">
                                <h4>
                                    <span class="material-symbols-outlined" style="color: #667eea;">lightbulb</span>
                                    Đề Xuất
                                </h4>
                                <div id="cv-recommendations"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Interview Mode -->
            <div class="mode-content" id="interview-mode">
                <div class="interview-setup" id="interview-setup">
                    <div class="cv-upload" id="interview-cv-upload">
                        <div style="font-size: 3rem; color: #cbd5e0; margin-bottom: 1rem;">
                            <span class="material-symbols-outlined">upload_file</span>
                        </div>
                        <h3>Tải CV của bạn</h3>
                        <p>Kéo thả hoặc click để chọn file CV (PDF, DOC, DOCX, JPG, PNG)</p>
                        <input type="file" id="interview-cv-file" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" style="display: none;">
                        <div id="interview-cv-info" style="display: none; margin-top: 1rem;">
                            <p id="interview-cv-name" style="font-weight: 600; color: #48bb78;"></p>
                        </div>
                    </div>

                    <div class="interview-config">
                        <h3 style="margin-bottom: 1.5rem; color: #2d3748;">Cấu hình phỏng vấn</h3>
                        
                        <div class="config-group">
                            <label for="job-position">Vị trí ứng tuyển</label>
                            <select id="job-position">
                                <option value="frontend">Frontend Developer</option>
                                <option value="backend">Backend Developer</option>
                                <option value="fullstack">Fullstack Developer</option>
                                <option value="mobile">Mobile Developer</option>
                                <option value="devops">DevOps Engineer</option>
                                <option value="data">Data Scientist</option>
                                <option value="marketing">Marketing Specialist</option>
                                <option value="design">UI/UX Designer</option>
                                <option value="business">Business Analyst</option>
                                <option value="manager">Project Manager</option>
                            </select>
                        </div>

                        <div class="config-group">
                            <label for="interview-level">Cấp độ</label>
                            <select id="interview-level">
                                <option value="junior">Junior (0-2 năm)</option>
                                <option value="mid">Mid-level (2-5 năm)</option>
                                <option value="senior">Senior (5+ năm)</option>
                            </select>
                        </div>

                        <div class="config-group">
                            <label for="interview-duration">Thời gian (phút)</label>
                            <select id="interview-duration">
                                <option value="5">5 phút (Thử nghiệm)</option>
                                <option value="10">10 phút (Nhanh)</option>
                                <option value="15">15 phút (Ngắn)</option>
                                <option value="30">30 phút (Tiêu chuẩn)</option>
                                <option value="45">45 phút (Đầy đủ)</option>
                            </select>
                        </div>

                        <button class="start-btn" id="start-interview">
                            <span class="material-symbols-outlined">play_arrow</span>
                            Bắt đầu phỏng vấn
                        </button>
                    </div>
                </div>

                <div class="interview-chat" id="interview-chat">
                    <div class="chat-header">
                        <span class="material-symbols-outlined">smart_toy</span>
                        <span>AI Interviewer</span>
                        <div style="margin-left: auto;" id="interview-timer">00:00</div>
                    </div>
                    
                    <div class="interview-controls">
                        <div class="interview-status">
                            <div class="status-item">
                                <div class="status-indicator"></div>
                                <span>Đang phỏng vấn</span>
                            </div>
                            <div class="status-item">
                                <span class="material-symbols-outlined" style="font-size: 16px;">videocam</span>
                                <span>Camera: <span id="camera-status">Tắt</span></span>
                            </div>
                        </div>
                        
                        <div class="interview-actions">
                            <button class="control-btn camera" id="toggle-camera">
                                <span class="material-symbols-outlined">videocam</span>
                                Bật Camera
                            </button>
                            <button class="control-btn stop" id="stop-interview">
                                <span class="material-symbols-outlined">stop</span>
                                Dừng Phỏng Vấn
                            </button>
                        </div>
                    </div>

                    <div class="interview-main">
                        <div class="chat-area">
                            <div class="chat-messages" id="chat-messages"></div>
                            <div class="chat-input">
                                <input type="text" id="user-response" placeholder="Nhập câu trả lời của bạn...">
                                <button id="send-response">
                                    <span class="material-symbols-outlined">send</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="camera-panel" id="camera-panel">
                            <div class="video-feed">
                                <video id="candidateVideo" autoplay muted></video>
                                <div class="camera-overlay" id="camera-overlay">
                                    <div>
                                        <span class="material-symbols-outlined" style="font-size: 2rem; display: block; margin-bottom: 0.5rem;">videocam_off</span>
                                        Camera tắt
                                    </div>
                                </div>
                            </div>
                            
                            <div class="behavior-analysis">
                                <div class="behavior-score">
                                    <div class="behavior-score-number" id="real-time-score">--</div>
                                    <div style="font-size: 0.8rem; color: #4a5568;">Điểm hành vi</div>
                                </div>
                                
                                <div class="behavior-indicators">
                                    <div class="behavior-indicator">
                                        <span class="indicator-name">Giao tiếp mắt</span>
                                        <span class="indicator-status good" id="eye-contact-status">Tốt</span>
                                    </div>
                                    <div class="behavior-indicator">
                                        <span class="indicator-name">Biểu cảm</span>
                                        <span class="indicator-status average" id="expression-status">TB</span>
                                    </div>
                                    <div class="behavior-indicator">
                                        <span class="indicator-name">Tư thế</span>
                                        <span class="indicator-status good" id="posture-status">Tốt</span>
                                    </div>
                                    <div class="behavior-indicator">
                                        <span class="indicator-name">Tự tin</span>
                                        <span class="indicator-status average" id="confidence-status">TB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="interview-results" id="interview-results">
                    <div class="results-header">
                        <h2 class="results-title">Kết Quả Phỏng Vấn</h2>
                        <p class="results-subtitle">Phân tích toàn diện về hiệu suất phỏng vấn của bạn</p>
                    </div>

                    <div class="results-grid">
                        <div class="result-card">
                            <h3>
                                <span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 0.5rem;">psychology</span>
                                Phân Tích Hành Vi
                            </h3>
                            <div class="behavior-breakdown" id="behavior-breakdown">
                                <!-- Sẽ được điền bởi JavaScript -->
                            </div>
                        </div>

                        <div class="result-card">
                            <h3>
                                <span class="material-symbols-outlined" style="vertical-align: middle; margin-right: 0.5rem;">chat</span>
                                Đánh Giá Phỏng Vấn
                            </h3>
                            <div id="interview-feedback">
                                <!-- Sẽ được điền bởi JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                        <button class="start-btn" onclick="restartInterview()">
                            <span class="material-symbols-outlined">refresh</span>
                            Phỏng Vấn Lại
                        </button>
                        <button class="start-btn" onclick="downloadReport()">
                            <span class="material-symbols-outlined">download</span>
                            Tải Báo Cáo
                        </button>
                    </div>
                </div>
            </div>

            <!-- Holland Test Mode -->
            <div class="mode-content" id="holland-mode">
                <div class="holland-test">
                    <div class="test-progress">
                        <div class="test-progress-bar" id="progress-bar"></div>
                    </div>

                    <div id="holland-questions">
                        <!-- Questions will be generated here -->
                    </div>

                    <div class="test-results" id="test-results">
                        <div class="personality-type" id="personality-type"></div>
                        <div class="personality-description" id="personality-description"></div>
                        
                        <div class="career-suggestions" id="career-suggestions">
                            <h3 style="margin-bottom: 1rem;">Nghề nghiệp phù hợp</h3>
                            <div id="suggested-careers"></div>
                        </div>

                        <button class="start-btn" id="start-career-chat">
                            <span class="material-symbols-outlined">chat</span>
                            Tư vấn với AI Career Coach
                        </button>

                        <div class="career-chat" id="career-chat">
                            <div class="interview-chat active">
                                <div class="chat-header">
                                    <span class="material-symbols-outlined">psychology</span>
                                    <span>AI Career Coach</span>
                                </div>
                                <div class="chat-messages" id="career-chat-messages"></div>
                                <div class="chat-input">
                                    <input type="text" id="career-question" placeholder="Hỏi về nghề nghiệp, tương lai...">
                                    <button id="send-career-question">
                                        <span class="material-symbols-outlined">send</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <span>AI đang xử lý...</span>
        </div>
    </div>

    <script>
        // Configuration
        const GEMINI_API_KEY = 'AIzaSyBZS9KdjtXW-88gqbc9gLuT8-e4E606yhI';
        const GEMINI_MODEL = 'gemini-1.5-flash-latest';
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${GEMINI_API_KEY}`;        // Global variables
        let currentMode = 'cv-analysis';
        let uploadedCV = null;
        let currentQuestion = 0; // các hàm data 
        let hollandAnswers = [];
        let interviewStartTime = null;
        let interviewTimer = null;
        let personalityType = null;
        let cameraStream = null;
        let isRecording = false;
        let behaviorData = null;
        let behaviorAnalysisInterval = null;
        let interviewMessages = [];
        let behaviorScores = {
            communication: 0,
            confidence: 0,
            eyeContact: 0,
            posture: 0,
            expression: 0
        };
        // Career data
        let careerData = {};    
        let roadmapData = {};
        let isDataLoaded = false;

        // Holland Test Questions
        const hollandQuestions = [
            {
                question: "Bạn thích làm việc với tay và sử dụng các công cụ, máy móc?",
                type: "R",
                answers: [
                    { text: "Rất thích", score: 3 },
                    { text: "Thích", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không thích", score: 0 }
                ]
            },
            {
                question: "Bạn có hứng thú với việc nghiên cứu, phân tích dữ liệu và giải quyết vấn đề phức tạp?",
                type: "I",
                answers: [
                    { text: "Rất hứng thú", score: 3 },
                    { text: "Hứng thú", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không hứng thú", score: 0 }
                ]
            },
            {
                question: "Bạn thích các hoạt động sáng tạo như vẽ, viết, thiết kế?",
                type: "A",
                answers: [
                    { text: "Rất thích", score: 3 },
                    { text: "Thích", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không thích", score: 0 }
                ]
            },
            {
                question: "Bạn thích giúp đỡ, dạy dỗ và chăm sóc người khác?",
                type: "S",
                answers: [
                    { text: "Rất thích", score: 3 },
                    { text: "Thích", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không thích", score: 0 }
                ]
            },
            {
                question: "Bạn thích lãnh đạo, thuyết phục và có ảnh hưởng đến người khác?",
                type: "E",
                answers: [
                    { text: "Rất thích", score: 3 },
                    { text: "Thích", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không thích", score: 0 }
                ]
            },
            {
                question: "Bạn thích làm việc với số liệu, báo cáo và các công việc có tính hệ thống?",
                type: "C",
                answers: [
                    { text: "Rất thích", score: 3 },
                    { text: "Thích", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không thích", score: 0 }
                ]
            },
            {
                question: "Bạn thích làm việc ngoài trời và các hoạt động thể chất?",
                type: "R",
                answers: [
                    { text: "Rất thích", score: 3 },
                    { text: "Thích", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không thích", score: 0 }
                ]
            },
            {
                question: "Bạn thích tìm hiểu về khoa học, công nghệ và các lý thuyết mới?",
                type: "I",
                answers: [
                    { text: "Rất thích", score: 3 },
                    { text: "Thích", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không thích", score: 0 }
                ]
            },
            {
                question: "Bạn thích thể hiện bản thân qua âm nhạc, nghệ thuật hoặc văn học?",
                type: "A",
                answers: [
                    { text: "Rất thích", score: 3 },
                    { text: "Thích", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không thích", score: 0 }
                ]
            },
            {
                question: "Bạn thích làm việc trong môi trường có cấu trúc rõ ràng và quy trình cụ thể?",
                type: "C",
                answers: [
                    { text: "Rất thích", score: 3 },
                    { text: "Thích", score: 2 },
                    { text: "Bình thường", score: 1 },
                    { text: "Không thích", score: 0 }
                ]
            }
        ];

        // Holland personality types
        const hollandTypes = {
            R: { 
                name: "Realistic (Thực tế)", 
                description: "Bạn thích làm việc với tay, máy móc và các hoạt động thực tế. Phù hợp với các nghề kỹ thuật, xây dựng.",
                careers: ["Kỹ sư", "Thợ máy", "Kiến trúc sư", "Lập trình viên", "Thợ điện"]
            },
            I: { 
                name: "Investigative (Nghiên cứu)", 
                description: "Bạn thích tìm hiểu, phân tích và giải quyết vấn đề. Phù hợp với các nghề khoa học, nghiên cứu.",
                careers: ["Nhà khoa học", "Bác sĩ", "Nhà nghiên cứu", "Kỹ sư phần mềm", "Dược sĩ"]
            },
            A: { 
                name: "Artistic (Nghệ thuật)", 
                description: "Bạn có tính sáng tạo cao và thích thể hiện bản thân. Phù hợp với các nghề nghệ thuật, thiết kế.",
                careers: ["Nhà thiết kế", "Nghệ sĩ", "Nhà văn", "Diễn viên", "Nhiếp ảnh gia"]
            },
            S: { 
                name: "Social (Xã hội)", 
                description: "Bạn thích giúp đỡ và tương tác với người khác. Phù hợp với các nghề giáo dục, chăm sóc.",
                careers: ["Giáo viên", "Y tá", "Tư vấn viên", "Nhân viên xã hội", "Huấn luyện viên"]
            },
            E: { 
                name: "Enterprising (Kinh doanh)", 
                description: "Bạn thích lãnh đạo và thuyết phục. Phù hợp với các nghề quản lý, kinh doanh.",
                careers: ["Quản lý", "Nhân viên bán hàng", "Luật sư", "Giám đốc", "Doanh nhân"]
            },
            C: {
                name: "Conventional (Truyền thống)", 
                description: "Bạn thích trật tự và làm việc có hệ thống. Phù hợp với các nghề văn phòng, tài chính.",
                careers: ["Kế toán", "Thư ký", "Nhân viên ngân hàng", "Chuyên viên tài chính", "Quản trị viên"]
            }
        };

        // DOM Elements
        const modeButtons = document.querySelectorAll('.mode-btn');
        const modeContents = document.querySelectorAll('.mode-content');
        
        // CV Analysis Elements
        const cvUploadSection = document.getElementById('cv-upload-section');
        const cvAnalysisFile = document.getElementById('cv-analysis-file');
        const analyzeCvBtn = document.getElementById('analyze-cv-btn');
        const cvAnalysisResults = document.getElementById('cv-analysis-results');
        
        // Interview Elements
        const interviewCvUpload = document.getElementById('interview-cv-upload');
        const interviewCvFile = document.getElementById('interview-cv-file');
        const startInterviewBtn = document.getElementById('start-interview');
        const interviewChat = document.getElementById('interview-chat');
        const interviewSetup = document.getElementById('interview-setup');
        const chatMessages = document.getElementById('chat-messages');
        const userResponse = document.getElementById('user-response');
        const sendResponse = document.getElementById('send-response');
        const toggleCameraBtn = document.getElementById('toggle-camera');
        const stopInterviewBtn = document.getElementById('stop-interview');
        const cameraPanel = document.getElementById('camera-panel');
        const candidateVideo = document.getElementById('candidateVideo');
        const interviewResults = document.getElementById('interview-results');
        
        // Holland Test Elements
        const hollandQuestionsDiv = document.getElementById('holland-questions');
        const testResults = document.getElementById('test-results');
        const startCareerChat = document.getElementById('start-career-chat');
        const careerChat = document.getElementById('career-chat');
        const careerChatMessages = document.getElementById('career-chat-messages');
        const careerQuestion = document.getElementById('career-question');
        const sendCareerQuestion = document.getElementById('send-career-question');
        
        const loading = document.getElementById('loading');

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });        function initializeApp() {
            setupEventListeners();
            generateHollandQuestions();
            loadCareerData();
            loadBehaviorData();
        }

        function setupEventListeners() {
            // Mode switching
            modeButtons.forEach(btn => {
                btn.addEventListener('click', () => switchMode(btn.dataset.mode));
            });

            // CV Analysis
            cvUploadSection.addEventListener('click', () => cvAnalysisFile.click());
            cvAnalysisFile.addEventListener('change', handleCVAnalysisUpload);
            analyzeCvBtn.addEventListener('click', analyzeCV);

            // Interview CV upload
            interviewCvUpload.addEventListener('click', () => interviewCvFile.click());
            interviewCvFile.addEventListener('change', handleInterviewCVUpload);

            // Interview
            startInterviewBtn.addEventListener('click', startInterview);
            sendResponse.addEventListener('click', sendInterviewResponse);
            userResponse.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendInterviewResponse();
            });

            // Interview controls
            toggleCameraBtn.addEventListener('click', toggleCamera);
            stopInterviewBtn.addEventListener('click', stopInterview);

            // Career chat
            startCareerChat.addEventListener('click', startCareerChatbot);
            sendCareerQuestion.addEventListener('click', sendCareerMessage);
            careerQuestion.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendCareerMessage();
            });
        }

        function switchMode(mode) {
            currentMode = mode;
            
            // Update buttons
            modeButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });

            // Update content
            modeContents.forEach(content => {
                content.classList.toggle('active', content.id === `${mode}-mode`);
            });
        }

        // CV Analysis Functions
        function handleCVAnalysisUpload(event) {
            const file = event.target.files[0];
            if (file && validateFile(file)) {
                uploadedCV = file;
                cvUploadSection.classList.add('has-file');
                
                const isImageFile = file.type.startsWith('image/');
                const fileTypeText = isImageFile ? 'Hình ảnh CV' : 'Tài liệu CV';
                
                document.getElementById('cv-file-name').innerHTML = `
                    <span style="color: #48bb78;">${file.name}</span>
                    <br><small style="color: #666;">${fileTypeText} - ${(file.size / 1024).toFixed(1)} KB</small>
                `;
                document.getElementById('cv-file-info').style.display = 'block';
                
                // Chỉ hiển thị nút phân tích nếu là file hình ảnh
                if (isImageFile) {
                    analyzeCvBtn.style.display = 'flex';
                    analyzeCvBtn.disabled = false;
                    analyzeCvBtn.innerHTML = `
                        <span class="material-symbols-outlined">psychology</span>
                        Phân Tích CV
                    `;
                } else {
                    analyzeCvBtn.style.display = 'flex';
                    analyzeCvBtn.disabled = true;
                    analyzeCvBtn.style.opacity = '0.5';
                    analyzeCvBtn.style.cursor = 'not-allowed';
                    analyzeCvBtn.innerHTML = `
                        <span class="material-symbols-outlined">block</span>
                        Chỉ hỗ trợ phân tích file hình ảnh
                    `;
                    
                    // Thông báo cho người dùng
                    setTimeout(() => {
                        alert('Hiện tại chỉ hỗ trợ phân tích CV dạng hình ảnh (JPG, PNG). Vui lòng chọn file hình ảnh của CV!');
                    }, 100);
                }
            }
        }

        async function analyzeCV() {
            if (!uploadedCV) {
                alert('Vui lòng chọn file CV trước khi phân tích!');
                return;
            }

            // Kiểm tra file có phải là hình ảnh không
            if (!uploadedCV.type.startsWith('image/')) {
                alert('Hiện tại chỉ hỗ trợ phân tích CV dạng hình ảnh (JPG, PNG). Vui lòng chọn file hình ảnh của CV!');
                return;
            }

            showLoading(true);
            
            try {
                const cvContent = await readCVContent(uploadedCV);
                const analysis = await getCVAnalysisFromAI(cvContent);
                
                displayCVResults(analysis);
                showLoading(false);
            } catch (error) {
                console.error('Error analyzing CV:', error);
                alert('Có lỗi xảy ra khi phân tích CV. Vui lòng thử lại!');
                showLoading(false);
            }
        }

        async function getCVAnalysisFromAI(cvContent) {
            const prompt = `
            Phân tích CV sau và đưa ra đánh giá chi tiết theo công thức tính điểm cụ thể và định dạng JSON:

            CV Content: ${cvContent}

            CÔNG THỨC TÍNH ĐIỂM CV (Tổng 100 điểm):
            1. Trình bày & Định dạng (20 điểm): Bố cục, font chữ, màu sắc, độ rõ ràng
            2. Thông tin cá nhân (15 điểm): Họ tên, liên lạc, ảnh đại diện, thông tin cơ bản
            3. Kinh nghiệm làm việc (25 điểm): Thời gian, vị trí, mô tả công việc, thành tích
            4. Học vấn & Chứng chỉ (20 điểm): Bằng cấp, khóa học, chứng chỉ chuyên môn
            5. Kỹ năng chuyên môn (15 điểm): Kỹ năng cứng, mềm, công nghệ, ngôn ngữ
            6. Tính phù hợp vị trí (5 điểm): Mức độ phù hợp với các vị trí thông thường

            Vui lòng trả về JSON với cấu trúc sau:
            {
                "score": 85,
                "breakdown": {
                    "presentation": 18,
                    "personalInfo": 13,
                    "experience": 22,
                    "education": 17,
                    "skills": 12,
                    "relevance": 3
                },
                "strengths": ["Kinh nghiệm phong phú", "Kỹ năng đa dạng"],
                "weaknesses": ["Thiếu chứng chỉ", "Mô tả công việc chưa rõ ràng"],
                "recommendations": ["Bổ sung chứng chỉ chuyên môn", "Chi tiết hóa thành tích"],
                "rating": "Tốt"
            }

            Điểm số từ 0-100. Rating: "Xuất sắc" (90-100), "Tốt" (75-89), "Khá" (60-74), "Trung bình" (45-59), "Yếu" (0-44).
            Hãy đánh giá chi tiết và chính xác dựa trên từng tiêu chí trong công thức.
            `;

            const response = await fetch(GEMINI_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }]
                })
            });

            const data = await response.json();
            const aiResponse = data.candidates[0].content.parts[0].text;
            
            try {
                // Parse JSON from AI response
                const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    return JSON.parse(jsonMatch[0]);
                }
            } catch (e) {
                console.error('Error parsing AI response:', e);
            }
            
            // Fallback response với breakdown chi tiết
            return {
                score: 75,
                breakdown: {
                    presentation: 15,
                    personalInfo: 12,
                    experience: 18,
                    education: 15,
                    skills: 12,
                    relevance: 3
                },
                strengths: ["CV có cấu trúc rõ ràng", "Thông tin cá nhân đầy đủ"],
                weaknesses: ["Cần bổ sung thêm chi tiết kinh nghiệm", "Thiếu mô tả kỹ năng cụ thể"],
                recommendations: ["Thêm portfolio dự án", "Cập nhật kỹ năng mới", "Bổ sung chứng chỉ"],
                rating: "Khá"
            };
        }

        function displayCVResults(analysis) {
            document.getElementById('cv-score').textContent = analysis.score;
            
            // Hiển thị rating với màu sắc phù hợp
            const ratingElement = document.getElementById('cv-rating');
            const rating = analysis.rating || getRatingFromScore(analysis.score);
            ratingElement.textContent = rating;
            ratingElement.style.backgroundColor = getRatingColor(rating);
            ratingElement.style.color = '#fff';
            
            // Hiển thị breakdown điểm số nếu có
            if (analysis.breakdown) {
                document.getElementById('cv-score-breakdown').style.display = 'block';
                document.getElementById('score-presentation').textContent = `${analysis.breakdown.presentation || 0}/20`;
                document.getElementById('score-personal').textContent = `${analysis.breakdown.personalInfo || 0}/15`;
                document.getElementById('score-experience').textContent = `${analysis.breakdown.experience || 0}/25`;
                document.getElementById('score-education').textContent = `${analysis.breakdown.education || 0}/20`;
                document.getElementById('score-skills').textContent = `${analysis.breakdown.skills || 0}/15`;
                document.getElementById('score-relevance').textContent = `${analysis.breakdown.relevance || 0}/5`;
            }
            
            document.getElementById('cv-strengths').innerHTML = analysis.strengths
                .map(strength => `<p>• ${strength}</p>`).join('');
            
            document.getElementById('cv-weaknesses').innerHTML = analysis.weaknesses
                .map(weakness => `<p>• ${weakness}</p>`).join('');
            
            document.getElementById('cv-recommendations').innerHTML = analysis.recommendations
                .map(rec => `<p>• ${rec}</p>`).join('');
            
            cvAnalysisResults.classList.add('active');
        }

        function getRatingFromScore(score) {
            if (score >= 90) return 'Xuất sắc';
            if (score >= 75) return 'Tốt';
            if (score >= 60) return 'Khá';
            if (score >= 45) return 'Trung bình';
            return 'Yếu';
        }

        function getRatingColor(rating) {
            switch (rating) {
                case 'Xuất sắc': return '#28a745';
                case 'Tốt': return '#48bb78';
                case 'Khá': return '#ffc107';
                case 'Trung bình': return '#fd7e14';
                case 'Yếu': return '#dc3545';
                default: return '#6c757d';
            }
        }

        // Interview Functions
        function handleInterviewCVUpload(event) {
            const file = event.target.files[0];
            if (file && validateFile(file)) {
                uploadedCV = file;
                interviewCvUpload.classList.add('has-file');
                document.getElementById('interview-cv-name').innerHTML = `
                    <span style="color: #48bb78;">${file.name}</span>
                    <br><small style="color: #666;">${file.type.startsWith('image/') ? 'Hình ảnh CV' : 'Tài liệu CV'} - ${(file.size / 1024).toFixed(1)} KB</small>
                `;
                document.getElementById('interview-cv-info').style.display = 'block';
            }
        }

        async function startInterview() {
            if (!uploadedCV) {
                alert('Vui lòng tải CV trước khi bắt đầu phỏng vấn!');
                return;
            }

            showLoading(true);
            
            try {
                const cvContent = await readCVContent(uploadedCV);
                const position = document.getElementById('job-position').value;
                const level = document.getElementById('interview-level').value;
                const duration = document.getElementById('interview-duration').value;

                interviewSetup.style.display = 'none';
                interviewChat.classList.add('active');
                
                const welcomeMessage = `Xin chào! Tôi là AI Interviewer. Tôi sẽ phỏng vấn bạn cho vị trí ${getPositionName(position)} ở cấp độ ${level}. Cuộc phỏng vấn sẽ kéo dài ${duration} phút. 

Để có trải nghiệm tốt nhất, tôi khuyên bạn nên bật camera để phân tích hành vi phỏng vấn. Bạn có thể giới thiệu về bản thân không?`;
                
                addMessage('ai', welcomeMessage);
                
                startInterviewTimer(parseInt(duration));
                interviewStartTime = Date.now();
                interviewMessages = [];
                
                showLoading(false);
            } catch (error) {
                console.error('Error starting interview:', error);
                alert('Có lỗi xảy ra khi bắt đầu phỏng vấn. Vui lòng thử lại!');
                showLoading(false);
            }
        }

        async function sendInterviewResponse() {
            const response = userResponse.value.trim();
            if (!response) return;

            addMessage('user', response);
            interviewMessages.push({ sender: 'user', message: response, timestamp: Date.now() });
            userResponse.value = '';
            
            showLoading(true);
            
            try {
                const aiResponse = await getInterviewResponseFromAI(response);
                addMessage('ai', aiResponse);
                interviewMessages.push({ sender: 'ai', message: aiResponse, timestamp: Date.now() });
                showLoading(false);
            } catch (error) {
                console.error('Error getting AI response:', error);
                const fallbackResponse = 'Xin lỗi, tôi gặp sự cố kỹ thuật. Bạn có thể thử lại không?';
                addMessage('ai', fallbackResponse);
                interviewMessages.push({ sender: 'ai', message: fallbackResponse, timestamp: Date.now() });
                showLoading(false);
            }
        }

        function getPositionName(value) {
            const positions = {
                'frontend': 'Frontend Developer',
                'backend': 'Backend Developer', 
                'fullstack': 'Fullstack Developer',
                'mobile': 'Mobile Developer',
                'devops': 'DevOps Engineer',
                'data': 'Data Scientist',
                'marketing': 'Marketing Specialist',
                'design': 'UI/UX Designer',
                'business': 'Business Analyst',
                'manager': 'Project Manager'
            };
            return positions[value] || value;
        }

        function addMessage(sender, message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.innerHTML = `<p>${message}</p>`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function startInterviewTimer(duration) {
            let timeLeft = duration * 60; // Convert to seconds
            const timerElement = document.getElementById('interview-timer');
            
            interviewTimer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                timeLeft--;
                
                if (timeLeft < 0) {
                    clearInterval(interviewTimer);
                    alert('Thời gian phỏng vấn đã hết!');
                    stopInterview();
                }
            }, 1000);
        }

        function validateFile(file) {
            const maxSize = 10 * 1024 * 1024; // 10MB
            const allowedTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'image/jpeg',
                'image/jpg', 
                'image/png'
            ];

            if (file.size > maxSize) {
                alert('File quá lớn! Vui lòng chọn file nhỏ hơn 10MB.');
                return false;
            }

            if (!allowedTypes.includes(file.type)) {
                alert('Định dạng file không hỗ trợ! Vui lòng chọn file PDF, DOC, DOCX, JPG hoặc PNG.');
                return false;
            }

            return true;
        }

        async function readCVContent(file) {
            // This is a simplified version - in real implementation you'd use proper file parsing
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (file.type.startsWith('image/')) {
                        resolve(`[Hình ảnh CV - ${file.name}]`);
                    } else {
                        resolve(e.target.result || `[CV Document - ${file.name}]`);
                    }
                };
                
                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                } else {
                    reader.readAsText(file);
                }
            });
        }

        function showLoading(show) {
            loading.classList.toggle('show', show);
        }

        async function getInterviewResponseFromAI(userResponse) {
            const prompt = `
            Bạn là một interviewer chuyên nghiệp. Phản hồi câu trả lời của ứng viên một cách tự nhiên và hỏi câu hỏi tiếp theo phù hợp.
            
            Câu trả lời của ứng viên: ${userResponse}
            
            Hãy phản hồi ngắn gọn và hỏi câu hỏi tiếp theo liên quan đến công việc, kinh nghiệm hoặc kỹ năng.
            `;

            const response = await fetch(GEMINI_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }]
                })
            });

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        // Holland Test Functions
        function generateHollandQuestions() {
            const questionsContainer = hollandQuestionsDiv;
            questionsContainer.innerHTML = '';

            hollandQuestions.forEach((question, index) => {
                const questionCard = document.createElement('div');
                questionCard.className = `question-card ${index === 0 ? 'active' : ''}`;
                questionCard.innerHTML = `
                    <div class="question-number">Câu hỏi ${index + 1}/${hollandQuestions.length}</div>
                    <div class="question-text">${question.question}</div>
                    <div class="answer-options">
                        ${question.answers.map((answer, answerIndex) => `
                            <div class="answer-option" data-score="${answer.score}" data-type="${question.type}">
                                ${answer.text}
                            </div>
                        `).join('')}
                    </div>
                `;
                questionsContainer.appendChild(questionCard);
            });

            // Add navigation
            const navigation = document.createElement('div');
            navigation.className = 'test-navigation';
            navigation.innerHTML = `
                <button class="nav-btn secondary" id="prev-question" disabled>Câu trước</button>
                <button class="nav-btn primary" id="next-question" disabled>Câu tiếp</button>
            `;
            questionsContainer.appendChild(navigation);

            setupQuestionNavigation();
        }

        function setupQuestionNavigation() {
            const prevBtn = document.getElementById('prev-question');
            const nextBtn = document.getElementById('next-question');
            
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('answer-option')) {
                    // Remove previous selections
                    e.target.parentElement.querySelectorAll('.answer-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    
                    // Select current option
                    e.target.classList.add('selected');
                    
                    // Save answer
                    hollandAnswers[currentQuestion] = {
                        type: e.target.dataset.type,
                        score: parseInt(e.target.dataset.score)
                    };
                    
                    // Enable next button
                    nextBtn.disabled = false;
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentQuestion < hollandQuestions.length - 1) {
                    currentQuestion++;
                    showQuestion(currentQuestion);
                    updateProgress();
                } else {
                    calculateHollandResults();
                }
            });

            prevBtn.addEventListener('click', () => {
                if (currentQuestion > 0) {
                    currentQuestion--;
                    showQuestion(currentQuestion);
                    updateProgress();
                }
            });
        }

        function showQuestion(index) {
            document.querySelectorAll('.question-card').forEach((card, i) => {
                card.classList.toggle('active', i === index);
            });

            const prevBtn = document.getElementById('prev-question');
            const nextBtn = document.getElementById('next-question');
            
            prevBtn.disabled = index === 0;
            nextBtn.disabled = !hollandAnswers[index];
            nextBtn.textContent = index === hollandQuestions.length - 1 ? 'Hoàn thành' : 'Câu tiếp';
        }

        function updateProgress() {
            const progress = ((currentQuestion + 1) / hollandQuestions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
        }

        function calculateHollandResults() {
            const scores = { R: 0, I: 0, A: 0, S: 0, E: 0, C: 0 };
            
            hollandAnswers.forEach(answer => {
                if (answer) {
                    scores[answer.type] += answer.score;
                }
            });

            const maxScore = Math.max(...Object.values(scores));
            personalityType = Object.keys(scores).find(key => scores[key] === maxScore);
            
            displayHollandResults(personalityType, scores);
        }

        function displayHollandResults(type, scores) {
            const typeInfo = hollandTypes[type];
            
            document.getElementById('personality-type').textContent = typeInfo.name;
            document.getElementById('personality-description').textContent = typeInfo.description;
            
            const careersHtml = typeInfo.careers.map(career => 
                `<span style="background: #e0e7ff; color: #3730a3; padding: 0.5rem 1rem; border-radius: 20px; margin: 0.25rem; display: inline-block;">${career}</span>`
            ).join('');
            
            document.getElementById('suggested-careers').innerHTML = careersHtml;
            
            hollandQuestionsDiv.style.display = 'none';
            testResults.classList.add('active');
        }        // Career Chat Functions
        async function startCareerChatbot() {
            // Load career data if not loaded
            if (!isDataLoaded) {
                await loadCareerData();
            }
            
            careerChat.classList.add('active');
            
            const welcomeMessage = `Xin chào! Tôi là AI Career Coach. Dựa trên kết quả test Holland của bạn (${hollandTypes[personalityType].name}), tôi có thể tư vấn về:

• Nghề nghiệp phù hợp với tính cách của bạn
• Lộ trình phát triển sự nghiệp chi tiết
• Kỹ năng cần học thêm
• Cơ hội việc làm và mức lương

Tôi có dữ liệu về ${Object.keys(careerData).length} ngành nghề và ${Object.keys(roadmapData).length} lộ trình phát triển nghề nghiệp.

Bạn muốn tư vấn về điều gì?`;
            
            addCareerMessage('ai', welcomeMessage);
        }

        // Load all career data
        async function loadCareerData() {
            try {
                showLoading(true);
                
                // Load career categories
                const careerFiles = [
                    'nghề nghiệp công nghệ.json',
                    'nghề nghiệp y tế.json',
                    'nghề nghiệp tài chính ngân hàng.json',
                    'nghề nghiệp giáo dục.json',
                    'nghề nghiệp kỹ thuật xây dựng.json',
                    'nghề nghiệp kinh doanh.json',
                    'nghề nghiệp thiết kế.json',
                    'nghề nghiệp truyền thông marketing.json',
                    'nghề nghiệp nông nghiệp thủy sản.json',
                    'nghề nghiệp vận tải logistics.json',
                    'nghề nghiệp năng lượng điện lực.json',
                    'nghề nghiệp công nghiệp sản xuất.json',
                    'nghề nghiệp bán lẻ thương mại.json',
                    'nghề nghiệp dịch vụ du lịch.json',
                    'nghề nghiệp làm đẹp thẩm mỹ.json',
                    'nghề nghiệp thể thao giải trí.json',
                    'nghề nghiệp nghệ thuật văn hóa.json',
                    'nghề nghiệp bảo vệ an ninh.json',
                    'nghề nghiệp pháp lý luật.json'
                ];

                // Load roadmap files
                const roadmapFiles = [
                    'lộ trình frontend developer.json',
                    'lộ trình backend developer.json',
                    'lộ trình data scientist.json',
                    'lộ trình ui ux designer.json',
                    'lộ trình digital marketing.json',
                    'lộ trình bác sĩ.json',
                    'lộ trình kỹ sư xây dựng.json',
                    'lộ trình kế toán.json',
                    'lộ trình luật sư.json',
                    'lộ trình giáo viên.json',
                    'lộ trình điều dưỡng.json',
                    'lộ trình nhân sự hr.json',
                    'lộ trình kiến trúc sư.json',
                    'lộ trình tài chính ngân hàng.json',
                    'lộ trình báo chí truyền thông.json'
                ];

                // Load career data
                const careerPromises = careerFiles.map(async (file) => {
                    try {
                        const response = await fetch(`Data/tư vấn nghề nghiệp/ngành nghề/${file}`);
                        if (response.ok) {
                            const data = await response.json();
                            return { file, data };
                        }
                    } catch (error) {
                        console.warn(`Failed to load career file: ${file}`, error);
                    }
                    return null;
                });

                // Load roadmap data
                const roadmapPromises = roadmapFiles.map(async (file) => {
                    try {
                        const response = await fetch(`Data/tư vấn nghề nghiệp/RoadMap/${file}`);
                        if (response.ok) {
                            const data = await response.json();
                            return { file, data };
                        }
                    } catch (error) {
                        console.warn(`Failed to load roadmap file: ${file}`, error);
                    }
                    return null;
                });

                // Wait for all data to load
                const [careerResults, roadmapResults] = await Promise.all([
                    Promise.all(careerPromises),
                    Promise.all(roadmapPromises)
                ]);

                // Process career data
                careerResults.forEach(result => {
                    if (result && result.data) {
                        Object.assign(careerData, result.data);
                    }
                });

                // Process roadmap data
                roadmapResults.forEach(result => {
                    if (result && result.data) {
                        const fileName = result.file.replace('.json', '').replace('lộ trình ', '');
                        roadmapData[fileName] = result.data;
                    }
                });

                isDataLoaded = true;
                console.log('Career data loaded:', Object.keys(careerData).length, 'categories');
                console.log('Roadmap data loaded:', Object.keys(roadmapData).length, 'roadmaps');
                
                showLoading(false);
            } catch (error) {
                console.error('Error loading career data:', error);
                showLoading(false);
            }
        }

        // Get career recommendations based on Holland type
        function getCareerRecommendations(hollandType) {
            const recommendations = [];
            
            // Search through all career data for matching Holland types
            Object.keys(careerData).forEach(category => {
                const categoryData = careerData[category];
                Object.keys(categoryData).forEach(jobKey => {
                    const job = categoryData[jobKey];
                    if (job.kiểu_holland && job.kiểu_holland.includes(hollandType)) {
                        recommendations.push({
                            name: job.tên,
                            description: job.mô_tả,
                            salary: job.mức_lương,
                            skills: job.kỹ_năng_cần_thiết,
                            category: category
                        });
                    }
                });
            });
            
            return recommendations;
        }

        // Find roadmap for a specific career
        function findRoadmapForCareer(careerName) {
            const normalizedCareerName = careerName.toLowerCase();
            
            // Direct match
            const directMatch = Object.keys(roadmapData).find(key => 
                key.toLowerCase().includes(normalizedCareerName) ||
                normalizedCareerName.includes(key.toLowerCase())
            );
            
            if (directMatch) {
                return roadmapData[directMatch];
            }
            
            // Search by title
            const titleMatch = Object.keys(roadmapData).find(key => {
                const roadmap = roadmapData[key];
                return roadmap.title && roadmap.title.toLowerCase().includes(normalizedCareerName);
            });
            
            if (titleMatch) {
                return roadmapData[titleMatch];
            }
            
            return null;
        }        async function sendCareerMessage() {
            const question = careerQuestion.value.trim();
            if (!question) return;

            addCareerMessage('user', question);
            careerQuestion.value = '';
            
            showLoading(true);
            
            try {
                // Check if user is asking for specific roadmap
                const roadmapRequest = checkForRoadmapRequest(question);
                
                if (roadmapRequest) {
                    const roadmapResponse = generateRoadmapResponse(roadmapRequest);
                    addCareerMessage('ai', roadmapResponse);
                } else {
                    const response = await getCareerAdviceFromAI(question);
                    addCareerMessage('ai', response);
                }
                
                showLoading(false);
            } catch (error) {
                console.error('Error getting career advice:', error);
                addCareerMessage('ai', 'Xin lỗi, tôi gặp sự cố kỹ thuật. Bạn có thể thử lại không?');
                showLoading(false);
            }
        }

        // Check if user is asking for a specific roadmap
        function checkForRoadmapRequest(question) {
            const lowerQuestion = question.toLowerCase();
            const roadmapKeywords = ['lộ trình', 'roadmap', 'học', 'phát triển', 'trở thành'];
            
            if (roadmapKeywords.some(keyword => lowerQuestion.includes(keyword))) {
                // Find mentioned career
                for (const key of Object.keys(roadmapData)) {
                    if (lowerQuestion.includes(key.toLowerCase()) || 
                        lowerQuestion.includes(roadmapData[key].title?.toLowerCase())) {
                        return key;
                    }
                }
                
                // Check career data for mentioned jobs
                for (const category of Object.keys(careerData)) {
                    const categoryData = careerData[category];
                    for (const jobKey of Object.keys(categoryData)) {
                        const job = categoryData[jobKey];
                        if (lowerQuestion.includes(job.tên?.toLowerCase())) {
                            return findRoadmapForCareer(job.tên);
                        }
                    }
                }
            }
            
            return null;
        }

        // Generate detailed roadmap response
        function generateRoadmapResponse(roadmapKey) {
            const roadmap = typeof roadmapKey === 'string' ? roadmapData[roadmapKey] : roadmapKey;
            
            if (!roadmap) {
                return "Xin lỗi, tôi chưa có lộ trình chi tiết cho nghề nghiệp này. Bạn có thể hỏi về nghề nghiệp khác hoặc tôi có thể tư vấn chung về cách phát triển trong lĩnh vực này.";
            }

            let response = `## 📚 ${roadmap.title}\n\n`;
            response += `**Thời gian:** ${roadmap.duration}\n`;
            response += `**Độ khó:** ${roadmap.difficulty}\n\n`;
            response += `${roadmap.overview || roadmap.description}\n\n`;

            if (roadmap.phases && roadmap.phases.length > 0) {
                response += `### 🎯 Các giai đoạn học tập:\n\n`;
                
                roadmap.phases.forEach((phase, index) => {
                    response += `**${phase.phase || phase.title || `Giai đoạn ${index + 1}`}** (${phase.duration})\n`;
                    response += `${phase.description}\n\n`;
                    
                    if (phase.skills && phase.skills.length > 0) {
                        response += `Kỹ năng cần học:\n`;
                        phase.skills.slice(0, 3).forEach(skill => {
                            response += `• ${skill.name || skill.skill}: ${skill.timeEstimate || skill.timeToLearn || '2-4 tuần'}\n`;
                        });
                        response += `\n`;
                    }
                });
            }

            if (roadmap.careerPaths && roadmap.careerPaths.length > 0) {
                response += `### 💰 Cơ hội nghề nghiệp:\n\n`;
                roadmap.careerPaths.forEach(path => {
                    response += `• **${path.position}**: ${path.salaryRange}\n`;
                    response += `  ${path.description}\n\n`;
                });
            }

            if (roadmap.tips && roadmap.tips.length > 0) {
                response += `### 💡 Lời khuyên:\n\n`;
                roadmap.tips.slice(0, 3).forEach(tip => {
                    response += `• ${tip}\n`;
                });
                response += `\n`;
            }

            response += `Bạn có muốn tôi giải thích chi tiết về giai đoạn nào không?`;

            return response;
        }async function getCareerAdviceFromAI(question) {
            // Get career recommendations based on Holland type
            const recommendations = getCareerRecommendations(personalityType);
            const roadmapInfo = recommendations.map(career => {
                const roadmap = findRoadmapForCareer(career.name);
                return { career, roadmap };
            }).filter(item => item.roadmap);

            const prompt = `
            Bạn là một chuyên gia tư vấn nghề nghiệp với dữ liệu cập nhật về thị trường lao động Việt Nam.
            
            Thông tin người dùng:
            - Tính cách Holland: ${hollandTypes[personalityType].name} (${personalityType})
            - Mô tả: ${hollandTypes[personalityType].description}
            
            Nghề nghiệp phù hợp với tính cách này:
            ${recommendations.slice(0, 10).map(career => `
            - ${career.name}: ${career.description}
              Mức lương: ${career.salary ? Object.values(career.salary).join(' → ') : 'Liên hệ'}
              Kỹ năng: ${career.skills ? career.skills.slice(0, 5).join(', ') : 'Đang cập nhật'}
            `).join('')}
            
            Lộ trình phát triển có sẵn:
            ${roadmapInfo.slice(0, 5).map(item => `
            - ${item.career.name}: ${item.roadmap.duration} (${item.roadmap.difficulty})
              Giai đoạn: ${item.roadmap.phases ? item.roadmap.phases.length : 0} bước
            `).join('')}
            
            Câu hỏi của người dùng: ${question}
            
            Hãy tư vấn chi tiết và cụ thể dựa trên:
            1. Dữ liệu nghề nghiệp phù hợp với tính cách Holland
            2. Lộ trình phát triển cụ thể nếu có
            3. Mức lương và cơ hội nghề nghiệp thực tế
            4. Kỹ năng cần thiết và cách phát triển
            
            Đưa ra lời khuyên thực tế, khuyến khích và có thể thực hiện được.
            `;

            const response = await fetch(GEMINI_API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }]
                })
            });

            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        }

        // Show improvement notification
        function showCVReadingImprovement() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                z-index: 1000;
                max-width: 350px;
                font-size: 0.9rem;
                line-height: 1.4;
            `;
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; margin-bottom: 0.5rem;">
                    <span class="material-symbols-outlined" style="margin-right: 0.5rem;">upgrade</span>
                    <strong>Cải tiến mới!</strong>
                </div>
                <div>
                    ✅ Hệ thống đã được cập nhật để đọc CV thực tế<br>
                    ✅ Hỗ trợ OCR cho file ảnh<br>
                    ✅ Trích xuất văn bản từ PDF<br>
                    ✅ Phân tích chính xác với Gemini AI
                </div>
                <div style="margin-top: 0.8rem; text-align: right;">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 0.3rem 0.8rem; border-radius: 5px; cursor: pointer;">
                        Đóng
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 10 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 10000);
        }

        // Show notification when page loads
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(showCVReadingImprovement, 1000);
        });

        // Helper function to extract text from images using OCR
        async function extractTextFromImage(base64Data) {
            try {
                // Option 1: Use Google Vision API (if available)
                const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        requests: [{
                            image: { content: base64Data },
                            features: [{ type: 'TEXT_DETECTION', maxResults: 1 }]
                        }]
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.responses && data.responses[0].textAnnotations) {
                        return data.responses[0].textAnnotations[0].description;
                    }
                }
            } catch (error) {
                console.error('Vision API Error:', error);
            }
            
            // Option 2: Use Gemini API for image analysis
            try {
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: "Extract all text content from this CV image. Return only the plain text content without any formatting or explanations." },
                                { inline_data: { mime_type: "image/jpeg", data: base64Data } }
                            ]
                        }],
                        generationConfig: { temperature: 0, maxOutputTokens: 2048 }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                }
            } catch (error) {
                console.error('Gemini OCR Error:', error);
            }
            
            return null;
        }
        
        // Helper function to extract text from PDF files  
        async function extractTextFromPDF(arrayBuffer) {
            try {
                // Option 1: Use PDF.js library if available
                if (typeof pdfjsLib !== 'undefined') {
                    const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                    let fullText = '';
                    
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += pageText + '\n';
                    }
                    
                    return fullText.trim();
                }
            } catch (error) {
                console.error('PDF.js Error:', error);
            }
            
            // Option 2: Convert to base64 and use Gemini API
            try {
                const base64Data = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: "Extract all text content from this PDF document. Return only the plain text content without any formatting or explanations." },
                                { inline_data: { mime_type: "application/pdf", data: base64Data } }
                            ]
                        }],
                        generationConfig: { temperature: 0, maxOutputTokens: 2048 }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.candidates[0].content.parts[0].text;
                }
            } catch (error) {
                console.error('Gemini PDF Error:', error);
            }
            
            return null;
        }

        // Utility Functions
        function validateFile(file) {
            const allowedTypes = [
                'application/pdf',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                'image/jpeg',
                'image/jpg', 
                'image/png'
            ];
            
            const allowedExtensions = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png'];
            const fileExtension = file.name.toLowerCase().substring(file.name.lastIndexOf('.'));
            
            if (!allowedTypes.includes(file.type) && !allowedExtensions.includes(fileExtension)) {
                alert('Vui lòng chọn file CV có định dạng: PDF, DOC, DOCX, JPG, JPEG hoặc PNG');
                return false;
            }
            
            const maxSize = 10 * 1024 * 1024; // 10MB
            if (file.size > maxSize) {
                alert('Kích thước file quá lớn. Vui lòng chọn file nhỏ hơn 10MB');
                return false;
            }
                  return true;
        }

        // CV Parsing Function using Gemini API
        async function parseCvUsingGemini(cvText) {
            // 1. Preprocess cvText: normalize whitespace and line breaks, ensure UTF-8 encoding
            const preprocessedText = cvText
                .replace(/\s+/g, ' ')  // normalize multiple spaces/tabs to single space
                .replace(/\n+/g, '\n') // normalize multiple line breaks to single line break
                .trim();

            // 2. Build Gemini API request with temperature=0 and strict JSON schema
            const prompt = `Analyze the following CV text and extract information in the exact JSON format specified below.

IMPORTANT: Return ONLY the JSON object, no additional text or explanation.

Example output format:
{
  "full_name": "Nguyễn Văn A",
  "email": "nguyenvana@email.com",
  "phone": "0123456789",
  "education": [
    { "degree": "Cử nhân Công nghệ Thông tin", "school": "Đại học Bách Khoa Hà Nội", "year_range": "2018-2022" }
  ],
  "work_experience": [
    { "position": "Frontend Developer", "company": "FPT Software", "year_range": "2022-2024" }
  ]
}

CV Text to analyze:
${preprocessedText}

Extract the following information:
- full_name: Person's full name (string or null if not found)
- email: Email address (string or null if not found)
- phone: Phone number in Vietnamese format (string or null if not found)
- education: Array of education entries with degree, school, year_range (empty array if none found)
- work_experience: Array of work experience with position, company, year_range (empty array if none found)

Return the JSON object now:`;

            const requestBody = {
                contents: [{
                    parts: [{
                        text: prompt
                    }]
                }],
                generationConfig: {
                    temperature: 0,
                    maxOutputTokens: 1024
                }
            };

            try {
                // 3. Send the request and await response
                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                
                if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                    throw new Error('Invalid API response structure');
                }

                const responseText = data.candidates[0].content.parts[0].text.trim();
                
                // Try to extract JSON from response (in case there's extra text)
                let jsonMatch = responseText.match(/\{[\s\S]*\}/);
                let jsonText = jsonMatch ? jsonMatch[0] : responseText;
                
                // Parse the JSON response
                let parsedData;
                try {
                    parsedData = JSON.parse(jsonText);
                } catch (parseError) {
                    throw new Error(`Failed to parse JSON response: ${parseError.message}`);
                }

                // 4. Fallback regex extraction for missing fields
                let result = {
                    full_name: parsedData.full_name || null,
                    email: parsedData.email || null,
                    phone: parsedData.phone || null,
                    education: Array.isArray(parsedData.education) ? parsedData.education : [],
                    work_experience: Array.isArray(parsedData.work_experience) ? parsedData.work_experience : []
                };

                // Fallback regex for email if missing
                if (!result.email) {
                    const emailRegex = /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-z]{2,}/;
                    const emailMatch = preprocessedText.match(emailRegex);
                    if (emailMatch) {
                        result.email = emailMatch[0];
                    }
                }

                // Fallback regex for phone (Vietnamese format) if missing
                if (!result.phone) {
                    const phoneRegex = /\b0\d{9,10}\b/;
                    const phoneMatch = preprocessedText.match(phoneRegex);
                    if (phoneMatch) {
                        result.phone = phoneMatch[0];
                    }
                }

                // 5. Return the parsed object
                return result;

            } catch (error) {
                // If API call fails or JSON is invalid, return object with null/empty values
                return {
                    full_name: null,
                    email: null,
                    phone: null,
                    education: [],
                    work_experience: []
                };
            }
        }        async function readCVContent(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                if (file.type.startsWith('image/')) {
                    // For image files, try to extract text using OCR
                    reader.onload = async (e) => {
                        try {
                            // Try to use Google Vision API or Gemini for OCR
                            const base64Data = e.target.result.split(',')[1];
                            const ocrText = await extractTextFromImage(base64Data);
                            
                            if (ocrText && ocrText.trim().length > 50) {
                                resolve(ocrText);
                            } else {
                                // Fallback: Ask user to manually enter content
                                const userText = prompt(`File ảnh "${file.name}" cần được chuyển đổi thành văn bản.\n\nVui lòng nhập nội dung CV từ ảnh này (hoặc hủy để sử dụng file khác):`);
                                
                                if (userText && userText.trim().length > 0) {
                                    resolve(userText.trim());
                                } else {
                                    resolve(`CV từ file ảnh: ${file.name}\n[Cần nhập thủ công hoặc sử dụng file PDF/Word để đọc tự động]`);
                                }
                            }
                        } catch (error) {
                            console.error('OCR Error:', error);
                            // Fallback for image files
                            const userText = prompt(`Không thể đọc tự động file ảnh "${file.name}".\n\nVui lòng nhập nội dung CV từ ảnh này:`);
                            
                            if (userText && userText.trim().length > 0) {
                                resolve(userText.trim());  
                            } else {
                                resolve(`CV từ file ảnh: ${file.name}\n[Cần nhập thủ công để phân tích chính xác]`);
                            }
                        }
                    };
                    reader.readAsDataURL(file);
                    
                } else if (file.type === 'application/pdf') {
                    // For PDF files, try to extract text
                    reader.onload = async (e) => {
                        try {
                            // Try to use PDF.js or similar library for text extraction
                            const pdfText = await extractTextFromPDF(e.target.result);
                            
                            if (pdfText && pdfText.trim().length > 50) {
                                resolve(pdfText);
                            } else {
                                // Fallback: Ask user to provide content
                                const userText = prompt(`File PDF "${file.name}" không thể đọc tự động.\n\nVui lòng nhập nội dung CV từ PDF này (hoặc hủy để sử dụng file khác):`);
                                
                                if (userText && userText.trim().length > 0) {
                                    resolve(userText.trim());
                                } else {
                                    resolve(`CV từ file PDF: ${file.name}\n[Cần nhập thủ công để phân tích chính xác]`);
                                }
                            }
                        } catch (error) {
                            console.error('PDF Reading Error:', error);
                            // Fallback for PDF files
                            const userText = prompt(`Không thể đọc tự động file PDF "${file.name}".\n\nVui lòng nhập nội dung CV từ PDF này:`);
                            
                            if (userText && userText.trim().length > 0) {
                                resolve(userText.trim());
                            } else {
                                resolve(`CV từ file PDF: ${file.name}\n[Cần nhập thủ công để phân tích chính xác]`);
                            }
                        }
                    };
                    reader.readAsArrayBuffer(file);
                    
                } else {
                    // For DOC/DOCX and plain text files
                    reader.onload = (e) => {
                        const result = e.target.result;
                        
                        if (typeof result === 'string' && result.trim().length > 0) {
                            // Successfully read as text
                            resolve(result);
                        } else {
                            // For binary DOC files, ask user to provide content
                            const userText = prompt(`File "${file.name}" cần được chuyển đổi thành văn bản.\n\nVui lòng nhập nội dung CV từ file này (hoặc hủy để sử dụng file khác):`);
                            
                            if (userText && userText.trim().length > 0) {
                                resolve(userText.trim());
                            } else {
                                resolve(`CV từ file: ${file.name}\n[Cần nhập thủ công để phân tích chính xác]`);
                            }
                        }
                    };
                    reader.readAsText(file, 'UTF-8');
                }
                
                reader.onerror = reject;
            });
        }

        function getPositionName(position) {
            const positions = {
                frontend: 'Frontend Developer',
                backend: 'Backend Developer',
                fullstack: 'Fullstack Developer',
                mobile: 'Mobile Developer',
                devops: 'DevOps Engineer',
                data: 'Data Scientist',
                marketing: 'Marketing Specialist',
                design: 'UI/UX Designer',
                business: 'Business Analyst',
                manager: 'Project Manager'
            };
            return positions[position] || position;
        }

        function startInterviewTimer(duration) {
            interviewStartTime = Date.now();
            const endTime = interviewStartTime + (duration * 60 * 1000);
            
            interviewTimer = setInterval(() => {
                const now = Date.now();
                const remaining = Math.max(0, endTime - now);
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                document.getElementById('interview-timer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (remaining <= 0) {
                    clearInterval(interviewTimer);
                    addMessage('ai', 'Thời gian phỏng vấn đã hết. Cảm ơn bạn đã tham gia!');
                }
            }, 1000);
        }

        function addMessage(sender, message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = message;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addCareerMessage(sender, message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = message;
            careerChatMessages.appendChild(messageDiv);
            careerChatMessages.scrollTop = careerChatMessages.scrollHeight;
        }

        function showLoading(show) {
            loading.classList.toggle('show', show);
        }

        // Load behavior data from JSON file
        async function loadBehaviorData() {
            try {
                const response = await fetch('./Data/Phân tích hành vi/hành vi.json');
                behaviorData = await response.json();
                console.log('Behavior data loaded successfully');
            } catch (error) {
                console.error('Error loading behavior data:', error);
                // Fallback behavior data
                behaviorData = {
                    behavioral_categories: {
                        communication_skills: { weight: 25 },
                        emotional_intelligence: { weight: 20 },
                        confidence_assertiveness: { weight: 20 },
                        teamwork_collaboration: { weight: 15 },
                        adaptability_flexibility: { weight: 20 }
                    }
                };
            }
        }

        // Camera Functions
        async function toggleCamera() {
            if (!cameraStream) {
                await startCamera();
            } else {
                stopCamera();
            }
        }

        async function startCamera() {
            try {
                cameraStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    },
                    audio: false 
                });
                
                candidateVideo.srcObject = cameraStream;
                candidateVideo.style.display = 'block';
                
                document.getElementById('camera-overlay').style.display = 'none';
                document.getElementById('camera-status').textContent = 'Bật';
                
                toggleCameraBtn.innerHTML = '<span class="material-symbols-outlined">videocam_off</span>Tắt Camera';
                toggleCameraBtn.classList.add('active');
                
                cameraPanel.classList.add('active');
                
                // Start behavior analysis
                startBehaviorAnalysis();
                
            } catch (error) {
                console.error('Error accessing camera:', error);
                alert('Không thể truy cập camera. Vui lòng kiểm tra quyền truy cập và đảm bảo bạn đang sử dụng HTTPS.');
            }
        }

        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
                
                candidateVideo.srcObject = null;
                candidateVideo.style.display = 'none';
                
                document.getElementById('camera-overlay').style.display = 'flex';
                document.getElementById('camera-status').textContent = 'Tắt';
                
                toggleCameraBtn.innerHTML = '<span class="material-symbols-outlined">videocam</span>Bật Camera';
                toggleCameraBtn.classList.remove('active');
                
                cameraPanel.classList.remove('active');
                
                // Stop behavior analysis
                stopBehaviorAnalysis();
            }
        }

        // Behavior Analysis Functions
        function startBehaviorAnalysis() {
            if (behaviorAnalysisInterval) {
                clearInterval(behaviorAnalysisInterval);
            }

            behaviorAnalysisInterval = setInterval(() => {
                analyzeBehaviorFrame();
            }, 2000); // Analyze every 2 seconds
        }

        function stopBehaviorAnalysis() {
            if (behaviorAnalysisInterval) {
                clearInterval(behaviorAnalysisInterval);
                behaviorAnalysisInterval = null;
            }
        }

        function analyzeBehaviorFrame() {
            // Simulate behavior analysis (in real implementation, this would use AI/ML)
            const randomFactors = {
                timeOfDay: new Date().getHours(),
                sessionLength: interviewStartTime ? (Date.now() - interviewStartTime) / 60000 : 0,
                messageCount: interviewMessages.length
            };

            // Simulate different behavior scores based on random factors and time
            const baseScore = 70 + Math.random() * 20;
            const timeVariation = Math.sin(randomFactors.sessionLength / 5) * 10;
            
            behaviorScores.eyeContact = Math.max(50, Math.min(100, baseScore + timeVariation + (Math.random() - 0.5) * 15));
            behaviorScores.expression = Math.max(50, Math.min(100, baseScore + (Math.random() - 0.5) * 20));
            behaviorScores.posture = Math.max(50, Math.min(100, baseScore + (Math.random() - 0.5) * 10));
            behaviorScores.confidence = Math.max(50, Math.min(100, baseScore + timeVariation + (Math.random() - 0.5) * 15));

            updateBehaviorDisplay();
        }

        function updateBehaviorDisplay() {
            const overallScore = Math.round(
                (behaviorScores.eyeContact + behaviorScores.expression + 
                 behaviorScores.posture + behaviorScores.confidence) / 4
            );

            document.getElementById('real-time-score').textContent = overallScore;

            // Update individual indicators
            updateIndicatorStatus('eye-contact-status', behaviorScores.eyeContact);
            updateIndicatorStatus('expression-status', behaviorScores.expression);
            updateIndicatorStatus('posture-status', behaviorScores.posture);
            updateIndicatorStatus('confidence-status', behaviorScores.confidence);
        }

        function updateIndicatorStatus(elementId, score) {
            const element = document.getElementById(elementId);
            element.className = 'indicator-status';
            
            if (score >= 80) {
                element.classList.add('good');
                element.textContent = 'Tốt';
            } else if (score >= 65) {
                element.classList.add('average');
                element.textContent = 'TB';
            } else {
                element.classList.add('poor');
                element.textContent = 'Kém';
            }
        }

        // Interview Control Functions
        function stopInterview() {
            if (confirm('Bạn có chắc muốn kết thúc phỏng vấn?')) {
                clearInterval(interviewTimer);
                stopCamera();
                stopBehaviorAnalysis();
                
                // Show results
                interviewChat.classList.remove('active');
                generateInterviewResults();
                interviewResults.classList.add('active');
            }
        }

        function generateInterviewResults() {
            const overallBehaviorScore = Math.round(
                (behaviorScores.eyeContact + behaviorScores.expression + 
                 behaviorScores.posture + behaviorScores.confidence) / 4
            );

            // Generate behavior breakdown
            const behaviorBreakdown = document.getElementById('behavior-breakdown');
            behaviorBreakdown.innerHTML = `
                <div class="behavior-item">
                    <span class="behavior-name">Giao tiếp mắt</span>
                    <span class="behavior-score-small ${getScoreClass(behaviorScores.eyeContact)}">${Math.round(behaviorScores.eyeContact)}</span>
                </div>
                <div class="behavior-item">
                    <span class="behavior-name">Biểu cảm</span>
                    <span class="behavior-score-small ${getScoreClass(behaviorScores.expression)}">${Math.round(behaviorScores.expression)}</span>
                </div>
                <div class="behavior-item">
                    <span class="behavior-name">Tư thế</span>
                    <span class="behavior-score-small ${getScoreClass(behaviorScores.posture)}">${Math.round(behaviorScores.posture)}</span>
                </div>
                <div class="behavior-item">
                    <span class="behavior-name">Tự tin</span>
                    <span class="behavior-score-small ${getScoreClass(behaviorScores.confidence)}">${Math.round(behaviorScores.confidence)}</span>
                </div>
                <div class="behavior-item" style="border-top: 2px solid #e2e8f0; margin-top: 0.5rem; padding-top: 0.8rem; font-weight: 600;">
                    <span class="behavior-name">Tổng điểm hành vi</span>
                    <span class="behavior-score-small ${getScoreClass(overallBehaviorScore)}">${overallBehaviorScore}</span>
                </div>
            `;

            // Generate interview feedback
            const interviewFeedback = document.getElementById('interview-feedback');
            const feedbackText = generateFeedbackText(overallBehaviorScore);
            interviewFeedback.innerHTML = `
                <div style="text-align: left;">
                    <p style="margin-bottom: 1rem; line-height: 1.6;">${feedbackText}</p>
                    <div style="background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 3px solid #667eea;">
                        <strong>Thời gian phỏng vấn:</strong> ${formatInterviewDuration()}<br>
                        <strong>Số câu hỏi:</strong> ${interviewMessages.filter(msg => msg.sender === 'ai').length}<br>
                        <strong>Đánh giá tổng thể:</strong> ${getOverallRating(overallBehaviorScore)}
                    </div>
                </div>
            `;
        }

        function getScoreClass(score) {
            if (score >= 85) return 'score-excellent';
            if (score >= 75) return 'score-good';
            if (score >= 65) return 'score-average';
            return 'score-poor';
        }

        function generateFeedbackText(score) {
            if (score >= 85) {
                return "Xuất sắc! Bạn đã thể hiện rất tốt trong buổi phỏng vấn. Hành vi và cách giao tiếp của bạn cho thấy sự tự tin, chuyên nghiệp và phù hợp với vị trí.";
            } else if (score >= 75) {
                return "Tốt! Bạn đã có một buổi phỏng vấn khá tích cực. Một số khía cạnh có thể cải thiện thêm để tăng ấn tượng với nhà tuyển dụng.";
            } else if (score >= 65) {
                return "Trung bình. Bạn cần cải thiện một số kỹ năng phỏng vấn, đặc biệt là về giao tiếp phi ngôn ngữ và sự tự tin.";
            } else {
                return "Cần cải thiện nhiều. Hãy luyện tập thêm về kỹ năng phỏng vấn, đặc biệt chú ý đến ngôn ngữ cơ thể và cách trả lời câu hỏi.";
            }
        }

        function getOverallRating(score) {
            if (score >= 85) return "Xuất sắc";
            if (score >= 75) return "Tốt";
            if (score >= 65) return "Trung bình";
            return "Cần cải thiện";
        }

        function formatInterviewDuration() {
            if (!interviewStartTime) return "0 phút";
            const duration = Math.floor((Date.now() - interviewStartTime) / 60000);
            return `${duration} phút`;
        }

        function restartInterview() {
            // Reset states
            interviewResults.classList.remove('active');
            interviewSetup.style.display = 'grid';
            chatMessages.innerHTML = '';
            interviewMessages = [];
            
            // Reset behavior scores
            behaviorScores = {
                communication: 0,
                confidence: 0,
                eyeContact: 0,
                posture: 0,
                expression: 0
            };

            // Reset timer
            clearInterval(interviewTimer);
            interviewStartTime = null;
            document.getElementById('interview-timer').textContent = '00:00';
        }

        function downloadReport() {
            const reportData = {
                timestamp: new Date().toISOString(),
                interviewDuration: formatInterviewDuration(),
                behaviorScores: behaviorScores,
                overallScore: Math.round((behaviorScores.eyeContact + behaviorScores.expression + behaviorScores.posture + behaviorScores.confidence) / 4),
                messages: interviewMessages
            };

            const dataStr = JSON.stringify(reportData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `interview_report_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
    </script>
</body>
</html>  
